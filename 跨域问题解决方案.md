#### 背景说明
> 跨域是由浏览器的同源策略引起的，是指页面请求的url地址，必须与浏览器上的url地址处于同域上（即域名，端口，协议相同）。这是为了防止某域名下的接口被其他域名下的网页非法调用，是浏览器对JavaScript施加的安全限制。

这个的出发点是好的，但是在程序页面开发的过程中，却常常会给前端开发者带来麻烦。由于在前端开发过程中，静态资源是放在电脑本地的，访问这些资源通常通过IP方式（127.0.0.1）或者 localhost 访问，与线上服务器所在域名不符，不能顺利调用服务的端口。

解决跨域问题常用的解决方案有两个
* JSONP：利用script标签可跨域的特点，在跨域脚本中可以直接回调当前脚本的函数。
* CORS：服务器设置HTTP响应头中Access-Control-Allow-Origion的值，接触跨域限制。
值得注意的是，这两个跨域方案都存在一个致命的缺陷，严重依赖后端的协助。

> 所以，我们可以利用[代理]和[反向代理]技术来实现开发中的跨域问题。

#### 代理与反向代理
###### 代理
> 代理，也称正向代理，意思是一个位于客户端和目标服务器(target server)之间的服务器，为了从目标服务器取得内容，客户端向代理发送一个请求并指定目标(目标服务器)，然后代理向目标服务器转交请求并将获得的内容返回给客户端。

* 数据流程：
  * 数据请求过程：浏览器-> 代理服务器 -> 目标服务器
  * 数据返回过程：目标服务器 -> 代理服务器 -> 浏览器

* 应用：
  最经典的应用就是科学上网：我，是一个国内用户，访问不了Google，但是我能访问一个香港的某个代理服务器。这个香港的代理服务器可以访问Google 。于是我先把请求发送到那个代理服务器，告诉他我需要访问Google，代理服务器去取内容，最后返回给我。

  *就好比，大佬被抓起来坐牢了，不能出去买酱排骨，只好拜托小弟去买回来*

###### 反向代理
> 反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。

* 数据流程：
  * 数据请求过程：浏览器-> 反向代理服务器 -> 处理数据的服务器
  * 数据返回过程：处理数据的服务器 -> 反向代理服务器 -> 浏览器

#####比较

* 从用途上来讲：
  * 正向代理的典型用途是为在防火墙内的局域网客户端提供访问internet的途径。正向正向代理还可以使用缓冲特性减少网络使用率。

  * 反向代理的典型用途是为后端的多台服务器提供负载平衡，或为后端较慢的服务器提供缓冲服务。

* 从安全性来讲：

  * 正向代理允许客户端通过它访问任意网站并且隐藏客户端自身，因此你必须采取安全措施以确保仅为经过授权的客户端提供服务。

  * 反向代理对外都是透明的，访问者并不知道自己访问的是一个代理。

* 从使用方来看：

  * 正向代理是浏览器端进行配置的，与服务器端无关，甚至可以对服务端隐藏。

  * 反向代理是服务器端配置的，对浏览器端是透明的。

#### 利用代理实现跨域
###### 实现原理
> 对正向代理服务器进行配置，当获取非接口数据时，让代理服务器指向开发者本机的资源。当访问接口时，访问后端接口数据。
*相当于大佬让小弟把酱排骨饭里面的饭和酱排骨分开买，饭自己家煮，酱排骨才去饭店买。*

###### 程序运行过程
* 浏览器访问页面，假设访问淘宝页面：taobao.com/index.html(假设这个页面中调用了taobao.com/api/getNew获取最新商品的接口)
* taobao.com/index.html请求经过代理服务器进行配置，index.html页面请求127.0.0.1:3000
* 127.0.0.1:3000返回index.html文件给服务器
* 浏览器运行index.html页面，发起taobao.com/api/getNew请求
* taobao.com/api/getNew请求经过代理服务器，但由于没有对这个接口进行特殊配置，会正常访问淘宝服务器中的接口。
* 淘宝服务器接受到taobao.com/api/getNew请求，检查请求头的hosts字段，发现是taobao.com，没有跨域，将结果返回给代理服务器。
* 代理服务器拿到结果，返回给浏览器，浏览器进行解析显示。

#### 使用反向代理实现跨域
*反向代理需要用到nginx，其详细介绍请看[http://www.nginx.cn/doc/]这里*

###### 实现原理
原理大体相同，但是处理的端不同，反向代理实在服务器端进行处理。首先修改hosts文件，将域名指向开发者的电脑本身，把自己伪装成服务端，再通过nginx对不同的请求进行转发，把静态资源指向开发者本地电脑的资源，将接口指向实际的服务器。

*相当于把饭店设置在了黑社会的楼下，去楼下买酱排骨饭的时候，饭店饭自己做，酱排骨则偷偷跑去别的饭店买。*

###### 代理配置
* 设置hosts文件，将目标域名指向本机。
* 编辑nginx配置，对不同的资源请求，指向到对应地址。同样的，将静态资源指向本机服务，将接口指向真正的服务器。
###### 程序运行过程
* 浏览器访问页面，假设访问淘宝页面：taobao.com/index.html

* taobao.com域名解析先经过hosts文件配置，发现taobao.com域名指向127.0.0.1，则向本机发起请求。

* nginx接收到taobao.com/index.html请求，根据nginx的配置，将把这个请求转发给127.0.0.1:3000。

* 浏览器拿到index.html文件，发起taobao.com/api/getNew请求

nginx接收到taobao.com/api/getNew请求请求，根据nginx的配置，将把这个请求转发给真正的淘宝服务器中。

淘宝服务器将数据返回给nginx，再返回给浏览器执行。